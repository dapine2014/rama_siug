<?xml version="1.0" encoding="UTF-8" ?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml" 
    xmlns:viewmodels="clr-namespace:SIUGJ.ViewModels"
    xmlns:services="clr-namespace:SIUGJ.Services;assembly=SIUGJ.MAUI"
    x:DataType="viewmodels:HearingDetailViewModel"
    x:Class="SIUGJ.Views.HearingDetail">
    <ContentPage.Resources>
        <ResourceDictionary>
            <!-- Converter para comprobar si un objeto no es nulo -->
            <services:BooleanConverter x:Key="IsNotNullConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>
    <ContentPage.Content>
        <Grid>
            <!-- Indicador de carga -->
            <ActivityIndicator IsRunning="{Binding IsBusy}" IsVisible="{Binding IsBusy}" 
                           HorizontalOptions="Center" VerticalOptions="Center" />
            
            <!-- Mensaje de error -->
            <Label Text="{Binding ErrorMessage}" IsVisible="{Binding HasError}" 
                   TextColor="Red" HorizontalOptions="Center" VerticalOptions="Center"
                   Margin="20" />
                   
            <!-- Contenido principal - solo visible cuando HearingDetail no es nulo -->
            <StackLayout Padding="20" IsVisible="{Binding HearingDetail, Converter={StaticResource IsNotNullConverter}}">
                <StackLayout Orientation="Horizontal">
                    <Label Text="{Binding HearingDetail.Audience.tipoAudiencia}" FontSize="Subtitle" FontAttributes="Bold" TextColor="Black" />
                    <Label Text=" - " FontSize="Subtitle" FontAttributes="Bold" TextColor="Black" />                 
                </StackLayout>
                <Label Text="{Binding HearingDetail.UniqueCode}" MaxLines="1" FontSize="Subtitle" FontAttributes="Bold" TextColor="Black" />
                <Grid Padding="5">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>                    
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <StackLayout Grid.Row="0" Grid.Column="0" Orientation="Horizontal">
                         <Label FontFamily="Material" Text="&#xebcc;" VerticalTextAlignment="Center" />
                         <Label Text="{Binding HearingDetail.StartingString}" TextColor="gray" />
                    </StackLayout>                
                    <StackLayout Grid.Row="1" Grid.Column="0" Orientation="Horizontal">
                         <Label FontFamily="Material" Text="&#xe8b5;"  VerticalTextAlignment="Center" />
                         <Label Text="{Binding HearingDetail.StartTime}" TextColor="gray" />
                         <Label Text=" - " TextColor="gray" />
                         <Label Text="{Binding HearingDetail.EndTime}" TextColor="gray" />
                    </StackLayout>
                    <StackLayout Grid.Row="2" Grid.Column="0" Orientation="Horizontal">
                         <Label FontFamily="Material" Text="&#xe0c8;"  VerticalTextAlignment="Center" />
                         <Label Text="{Binding HearingDetail.Audience.sala}" TextColor="gray" />
                    </StackLayout>
                    <StackLayout Grid.Row="3" Grid.Column="0" Orientation="Horizontal">
                         <Label FontFamily="Material" Text="&#xf233;"  VerticalTextAlignment="Center" />
                         <Label Text="{Binding HearingDetail.Audience.totalParticipantes}" TextColor="gray" />
                         <Label Text=" Invitados" TextColor="gray" />
                    </StackLayout>
                    <Label Grid.Row="4" Grid.Column="0" Text="{Binding HearingDetail.Audience.despacho}" TextColor="gray" />
                    <Label Grid.Row="5" Grid.Column="0" Text="{Binding HearingDetail.Audience.juez}" TextColor="gray" />
                    <Label Grid.Row="6" Grid.Column="0" Text="{Binding HearingDetail.Audience.comentariosAdicionales}" TextColor="gray" />
                </Grid>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="150"/>
                    </Grid.ColumnDefinitions>
                    <Button Grid.Row="0" Grid.Column="0" Text="+ Unirme" CornerRadius="7" 
                            Command="{Binding ManageHearingCommand}" 
                            IsEnabled="{Binding HearingDetail.IsVirtual}" />
                </Grid>
                
                <!-- Añadido para depuración - mostrar ID recibido -->
                <Label Text="{Binding HearingDetail.IdEvento, StringFormat='ID recibido: {0}'}" 
                       FontSize="Small" TextColor="Gray" Margin="0,10,0,0" />
            </StackLayout>
        </Grid>
    </ContentPage.Content>
</ContentPage>
